openapi: 3.0.3
info:
  title: 3D Portfolio Blog API
  description: |
    REST API for 3D Interactive Portfolio Blog with AI Benchmark

    ## Features
    - JWT Authentication with Refresh Token Rotation
    - Blog CRUD (Posts, Categories, Tags, Comments)
    - AI Model Benchmark & Inference
    - OAuth2 Social Login

    ## Authentication
    Most endpoints require JWT authentication via `Authorization: Bearer {token}` header.

  version: 1.0.0
  contact:
    name: API Support
    email: your.email@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api/v1
    description: Local Development (Main API)
  - url: http://localhost:8000/api/v1
    description: Local Development (AI API)
  - url: https://api.yourdomain.com/api/v1
    description: Production (Main API)

tags:
  - name: Auth
    description: Authentication & Authorization
  - name: Posts
    description: Blog post management
  - name: Categories
    description: Post categories
  - name: Tags
    description: Post tags
  - name: Comments
    description: Comment management
  - name: Users
    description: User management
  - name: AI Models
    description: AI model management
  - name: Benchmark
    description: AI benchmark operations

paths:
  # ==========================================
  # Authentication
  # ==========================================
  /auth/signup:
    post:
      tags: [Auth]
      summary: 회원가입
      description: 새로운 사용자 계정 생성
      operationId: signup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, username, password]
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                username:
                  type: string
                  minLength: 3
                  maxLength: 20
                  example: johndoe
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecureP@ss123
      responses:
        '201':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    format: int64
                    example: 1
                  email:
                    type: string
                    example: user@example.com
                  username:
                    type: string
                    example: johndoe
                  role:
                    type: string
                    example: USER
                  createdAt:
                    type: string
                    format: date-time
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: 이메일 또는 사용자명 중복
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      tags: [Auth]
      summary: 로그인
      description: 이메일/비밀번호로 로그인하여 Access Token 및 Refresh Token 발급
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecureP@ss123
      responses:
        '200':
          description: 로그인 성공
          headers:
            Set-Cookie:
              description: Refresh Token (HttpOnly Cookie)
              schema:
                type: string
                example: refresh_token=abc123...; HttpOnly; Secure; SameSite=Strict; Max-Age=604800; Path=/api/v1/auth/refresh
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  username:
                    type: string
                    example: johndoe
                  role:
                    type: string
                    example: USER
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Access Token 갱신
      description: Refresh Token을 사용하여 새로운 Access Token 및 Refresh Token 발급 (Rotation)
      operationId: refreshToken
      parameters:
        - in: cookie
          name: refresh_token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 토큰 갱신 성공
          headers:
            Set-Cookie:
              description: 새로운 Refresh Token (HttpOnly Cookie)
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          description: Refresh Token 만료 또는 재사용 감지
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags: [Auth]
      summary: 로그아웃
      description: Refresh Token 무효화 및 쿠키 삭제
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '204':
          description: 로그아웃 성공
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==========================================
  # Posts
  # ==========================================
  /posts:
    get:
      tags: [Posts]
      summary: 게시글 목록 조회
      description: 페이징 처리된 게시글 목록 조회
      operationId: getPosts
      parameters:
        - name: page
          in: query
          description: 페이지 번호 (0부터 시작)
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          description: 페이지 크기
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: categoryId
          in: query
          description: 카테고리 필터
          schema:
            type: integer
            format: int64
        - name: tagId
          in: query
          description: 태그 필터
          schema:
            type: integer
            format: int64
        - name: status
          in: query
          description: 상태 필터
          schema:
            type: string
            enum: [DRAFT, PUBLISHED, ARCHIVED]
        - name: sort
          in: query
          description: 정렬 기준
          schema:
            type: string
            enum: [createdAt,desc, createdAt,asc, viewCount,desc, likeCount,desc]
            default: createdAt,desc
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/PostSummary'
                  page:
                    type: integer
                    example: 0
                  size:
                    type: integer
                    example: 20
                  totalElements:
                    type: integer
                    example: 150
                  totalPages:
                    type: integer
                    example: 8

    post:
      tags: [Posts]
      summary: 게시글 작성
      description: 새로운 게시글 작성 (인증 필요)
      operationId: createPost
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostCreateRequest'
      responses:
        '201':
          description: 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /posts/{id}:
    get:
      tags: [Posts]
      summary: 게시글 상세 조회
      description: ID로 게시글 상세 정보 조회
      operationId: getPost
      parameters:
        - name: id
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostDetail'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Posts]
      summary: 게시글 수정
      description: 게시글 내용 수정 (작성자 또는 관리자만)
      operationId: updatePost
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostUpdateRequest'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Posts]
      summary: 게시글 삭제
      description: 게시글 삭제 (Soft Delete, 작성자 또는 관리자만)
      operationId: deletePost
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: 삭제 성공
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==========================================
  # Categories
  # ==========================================
  /categories:
    get:
      tags: [Categories]
      summary: 카테고리 목록 조회
      operationId: getCategories
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  # ==========================================
  # Tags
  # ==========================================
  /tags:
    get:
      tags: [Tags]
      summary: 태그 목록 조회
      operationId: getTags
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tag'

  # ==========================================
  # Comments
  # ==========================================
  /posts/{postId}/comments:
    get:
      tags: [Comments]
      summary: 게시글 댓글 목록 조회
      operationId: getComments
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'

    post:
      tags: [Comments]
      summary: 댓글 작성
      operationId: createComment
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
                parentId:
                  type: integer
                  format: int64
                  description: 답글인 경우 부모 댓글 ID
      responses:
        '201':
          description: 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

# ==========================================
# Components
# ==========================================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Access Token (Authorization: Bearer {token})

  schemas:
    # ==========================================
    # Post Schemas
    # ==========================================
    PostSummary:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        title:
          type: string
          example: "My First Blog Post"
        slug:
          type: string
          example: "my-first-blog-post"
        excerpt:
          type: string
          example: "This is a short summary of the blog post..."
        author:
          type: object
          properties:
            id:
              type: integer
              format: int64
            username:
              type: string
              example: "johndoe"
        category:
          $ref: '#/components/schemas/Category'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        status:
          type: string
          enum: [DRAFT, PUBLISHED, ARCHIVED]
          example: PUBLISHED
        viewCount:
          type: integer
          example: 150
        likeCount:
          type: integer
          example: 25
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PostDetail:
      allOf:
        - $ref: '#/components/schemas/PostSummary'
        - type: object
          properties:
            content:
              type: string
              description: Markdown 형식 콘텐츠
              example: "# Introduction\n\nThis is my first post..."
            publishedAt:
              type: string
              format: date-time

    PostCreateRequest:
      type: object
      required: [title, content]
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
          example: "My First Blog Post"
        content:
          type: string
          minLength: 1
          example: "# Introduction\n\nThis is my first post..."
        excerpt:
          type: string
          maxLength: 200
        categoryId:
          type: integer
          format: int64
          example: 1
        tagIds:
          type: array
          items:
            type: integer
            format: int64
          example: [1, 2, 3]
        status:
          type: string
          enum: [DRAFT, PUBLISHED]
          default: DRAFT

    PostUpdateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        content:
          type: string
          minLength: 1
        excerpt:
          type: string
          maxLength: 200
        categoryId:
          type: integer
          format: int64
        tagIds:
          type: array
          items:
            type: integer
            format: int64
        status:
          type: string
          enum: [DRAFT, PUBLISHED, ARCHIVED]

    # ==========================================
    # Category & Tag Schemas
    # ==========================================
    Category:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Technology"
        slug:
          type: string
          example: "technology"
        description:
          type: string
          example: "Tech-related articles"

    Tag:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "React"
        slug:
          type: string
          example: "react"

    # ==========================================
    # Comment Schema
    # ==========================================
    Comment:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        content:
          type: string
          example: "Great post!"
        author:
          type: object
          properties:
            id:
              type: integer
              format: int64
            username:
              type: string
              example: "janedoe"
        parentId:
          type: integer
          format: int64
          nullable: true
        replies:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # ==========================================
    # Error Response
    # ==========================================
    ErrorResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          example: "2026-01-07T10:30:00Z"
        status:
          type: integer
          example: 400
        error:
          type: string
          example: "Bad Request"
        message:
          type: string
          example: "Validation failed for field 'email'"
        errorCode:
          type: string
          example: "VALIDATION_ERROR"
        path:
          type: string
          example: "/api/v1/posts"

  responses:
    BadRequest:
      description: 잘못된 요청 (유효성 검증 실패)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2026-01-07T10:30:00Z"
            status: 400
            error: "Bad Request"
            message: "Title is required"
            errorCode: "VALIDATION_ERROR"

    Unauthorized:
      description: 인증 필요
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2026-01-07T10:30:00Z"
            status: 401
            error: "Unauthorized"
            message: "JWT token is missing or invalid"
            errorCode: "UNAUTHORIZED"

    Forbidden:
      description: 권한 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2026-01-07T10:30:00Z"
            status: 403
            error: "Forbidden"
            message: "You don't have permission to access this resource"
            errorCode: "FORBIDDEN"

    NotFound:
      description: 리소스 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2026-01-07T10:30:00Z"
            status: 404
            error: "Not Found"
            message: "Post not found with id: 123"
            errorCode: "POST_NOT_FOUND"
